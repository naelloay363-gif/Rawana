<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø±ÙˆØ§Ù†Ø§ Ø´ÙˆØ²</title>

<style>
*{box-sizing:border-box;font-family:tahoma}
body{margin:0;background:#f2f4f7}
header{background:#2f80ed;color:#fff;padding:12px;text-align:center}
#tabs{display:flex;gap:6px;padding:8px;overflow-x:auto;background:#2f80ed}
.tab{padding:8px 14px;background:#ffffff55;border-radius:18px;color:#fff;font-size:14px;cursor:pointer}
.tab.active{background:#fff;color:#2f80ed;font-weight:bold}
.section{display:none;padding:10px}
.section.active{display:block}
.card{background:#fff;padding:12px;border-radius:14px;margin-bottom:10px}
input,select,button,textarea{
  width:100%;padding:10px;margin-top:6px;
  font-size:15px;border-radius:10px;border:1px solid #ccc
}
textarea{resize:none}
button{background:#2f80ed;color:#fff;border:none;font-weight:bold}
.green{background:#27ae60}
.red{background:#eb5757}
.gray{background:#555}
.row{display:flex;gap:6px}
.row>*{flex:1}
small{color:#666}
hr{border:none;border-top:1px solid #eee;margin:10px 0}
table{border-collapse:collapse;width:100%}
table, th, td{border:1px solid #ccc;padding:6px;text-align:center}
</style>
</head>

<body>

<header>
<h3>Ø±ÙˆØ§Ù†Ø§ Ø´ÙˆØ²</h3>
<small>Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø© ÙˆÙ…Ø®Ø²Ù† â€“ Ø´ÙŠÙƒÙ„ â‚ª</small>
</header>

<div id="tabs">
  <div class="tab active" onclick="show('sales',this)">Ù…Ø¨ÙŠØ¹Ø§Øª</div>
  <div class="tab" onclick="show('stock',this)">Ø§Ù„Ù…Ø®Ø²Ù†</div>
  <div class="tab" onclick="show('expenses',this)">Ù…ØµØ±ÙˆÙØ§Øª</div>
  <div class="tab" onclick="show('cashbox',this)">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</div>
  <div class="tab" onclick="show('reports',this)">ØªÙ‚Ø§Ø±ÙŠØ±</div>
</div>

<!-- Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª -->
<div id="sales" class="section active">
<div class="card">
<h4>Ø¨ÙŠØ¹</h4>
<select id="saleItem"></select>
<div class="row">
<input type="number" id="saleQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" value="1">
<input type="number" id="salePrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
</div>
<select id="salePay">
<option value="cash">ÙƒØ§Ø´</option>
<option value="bank">Ø¨Ù†Ùƒ</option>
</select>
<textarea id="saleNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
<button class="green" onclick="addSale()">ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨ÙŠØ¹</button>
</div>
</div>

<!-- Ø§Ù„Ù…Ø®Ø²Ù† -->
<div id="stock" class="section">
<div class="card">
<h4>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</h4>
<input id="itemName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input type="number" id="itemQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<input type="number" id="itemPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">
<button onclick="addItem()">Ø­ÙØ¸</button>
</div>
</div>

<!-- Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
<div id="expenses" class="section">
<div class="card">
<h4>Ù…ØµØ±ÙˆÙ</h4>
<input id="expName" placeholder="Ø§Ù„Ø³Ø¨Ø¨">
<input type="number" id="expAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<select id="expPay">
<option value="cash">ÙƒØ§Ø´</option>
<option value="bank">Ø¨Ù†Ùƒ</option>
</select>
<textarea id="expNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
<button class="red" onclick="addExpense()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
</div>
</div>

<!-- Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ -->
<div id="cashbox" class="section">
<div class="card">
<h4>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</h4>
<p>ğŸ’µ ÙƒØ§Ø´: â‚ª <b id="cashTotal">0</b></p>
<p>ğŸ¦ Ø¨Ù†Ùƒ: â‚ª <b id="bankTotal">0</b></p>

<hr>
<h4>Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</h4>
<input type="number" id="withdrawAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<select id="withdrawPay">
<option value="cash">ÙƒØ§Ø´</option>
<option value="bank">Ø¨Ù†Ùƒ</option>
</select>
<textarea id="withdrawNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø³Ø­Ø¨"></textarea>
<button class="red" onclick="withdrawCash()">Ø³Ø­Ø¨</button>
</div>
</div>

<!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
<div id="reports" class="section">
<div class="card">
<h4>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h4>

<select id="reportType">
<option value="daily">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</option>
<option value="monthly">ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</option>
<option value="stock">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²Ù†</option>
<option value="details">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø±ÙƒØ§Øª</option>
</select>

<input type="date" id="repDate" placeholder="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ…">
<input type="month" id="repMonth" placeholder="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ù‡Ø±">

<button onclick="generateReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>

<hr>
<button onclick="printPDF()">ğŸ“„ Ø­ÙØ¸ PDF</button>
<hr>
<button onclick="exportBackup()">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø©</button>
<input type="file" onchange="importBackup(this.files[0])">

<div id="repResult"></div>
</div>
</div>

<script>
let stock = JSON.parse(localStorage.stock||"[]");
let sales = JSON.parse(localStorage.sales||"[]");
let expenses = JSON.parse(localStorage.expenses||"[]");
let cash = +localStorage.cash||0;
let bank = +localStorage.bank||0;

function save(){
 localStorage.stock=JSON.stringify(stock);
 localStorage.sales=JSON.stringify(sales);
 localStorage.expenses=JSON.stringify(expenses);
 localStorage.cash=cash;
 localStorage.bank=bank;
 load();
}

function show(id,el){
 document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
 document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 el.classList.add('active');
}

function load(){
 let s=document.getElementById("saleItem");
 s.innerHTML="";
 stock.forEach((i,n)=>{
  s.innerHTML+=`<option value="${n}">${i.name} (${i.qty})</option>`;
 });
 cashTotal.innerText=cash;
 bankTotal.innerText=bank;
}

function addItem(){
 if(!itemName.value)return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù");
 stock.push({name:itemName.value,qty:+itemQty.value,price:+itemPrice.value});
 save(); alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù");
}

function addSale(){
 let i=stock[saleItem.value];
 let q=+saleQty.value;
 let p=salePrice.value||i.price;
 if(i.qty<q)return alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©");
 i.qty-=q;
 let total=q*p;
 if(salePay.value=="cash") cash+=total; else bank+=total;
 sales.push({name:i.name,qty:q,price:p,pay:salePay.value,note:saleNote.value,date:new Date().toISOString().slice(0,10)});
 save(); alert("ØªÙ… Ø§Ù„Ø¨ÙŠØ¹");
}

function addExpense(){
 let a=+expAmount.value;
 if(expPay.value=="cash") cash-=a; else bank-=a;
 expenses.push({name:expName.value,amount:a,pay:expPay.value,note:expNote.value,date:new Date().toISOString().slice(0,10)});
 save(); alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ");
}

/* Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ */
function withdrawCash(){
  let amt = +document.getElementById("withdrawAmount").value;
  let pay = document.getElementById("withdrawPay").value;
  let note = document.getElementById("withdrawNote").value;
  if(amt <=0) return alert("Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­");
  if(pay=="cash" && amt>cash) return alert("Ø§Ù„Ù…Ø¨Ù„Øº Ø£ÙƒØ¨Ø± Ù…Ù† Ø±ØµÙŠØ¯ Ø§Ù„ÙƒØ§Ø´");
  if(pay=="bank" && amt>bank) return alert("Ø§Ù„Ù…Ø¨Ù„Øº Ø£ÙƒØ¨Ø± Ù…Ù† Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ù†Ùƒ");

  // Ø®ØµÙ… Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
  if(pay=="cash") cash -= amt;
  else bank -= amt;

  // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ø¬Ù„Ø§Øª ÙƒÙ…ØµØ±ÙˆÙ
  expenses.push({
    name:"Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚",
    amount:amt,
    pay:pay,
    note:note,
    date:new Date().toISOString().slice(0,10)
  });

  save();
  alert("ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
  document.getElementById("withdrawAmount").value="";
  document.getElementById("withdrawNote").value="";
}

/* Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
function generateReport(){
 const type=document.getElementById("reportType").value;
 let html="";
 if(type=="daily"){
   let d=repDate.value;
   if(!d){alert("Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®"); return;}
   let cashSales=sales.filter(x=>x.date==d && x.pay=="cash").reduce((t,x)=>t+x.qty*x.price,0);
   let bankSales=sales.filter(x=>x.date==d && x.pay=="bank").reduce((t,x)=>t+x.qty*x.price,0);
   let cashExp=expenses.filter(x=>x.date==d && x.pay=="cash").reduce((t,x)=>t+x.amount,0);
   let bankExp=expenses.filter(x=>x.date==d && x.pay=="bank").reduce((t,x)=>t+x.amount,0);
   html=`ğŸ“… ${d}<br>
   Ù…Ø¨ÙŠØ¹Ø§Øª ÙƒØ§Ø´: â‚ª ${cashSales}<br>
   Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ùƒ: â‚ª ${bankSales}<br>
   Ù…ØµØ±ÙˆÙØ§Øª ÙƒØ§Ø´: â‚ª ${cashExp}<br>
   Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ùƒ: â‚ª ${bankExp}<br>
   Ø§Ù„ØµØ§ÙÙŠ: â‚ª ${(cashSales+bankSales)-(cashExp+bankExp)}`;
 }
 else if(type=="monthly"){
   let m=repMonth.value;
   if(!m){alert("Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø±"); return;}
   let cashSales=sales.filter(x=>x.date.startsWith(m) && x.pay=="cash").reduce((t,x)=>t+x.qty*x.price,0);
   let bankSales=sales.filter(x=>x.date.startsWith(m) && x.pay=="bank").reduce((t,x)=>t+x.qty*x.price,0);
   let cashExp=expenses.filter(x=>x.date.startsWith(m) && x.pay=="cash").reduce((t,x)=>t+x.amount,0);
   let bankExp=expenses.filter(x=>x.date.startsWith(m) && x.pay=="bank").reduce((t,x)=>t+x.amount,0);
   html=`ğŸ“† ${m}<br>
   Ù…Ø¨ÙŠØ¹Ø§Øª ÙƒØ§Ø´: â‚ª ${cashSales}<br>
   Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ùƒ: â‚ª ${bankSales}<br>
   Ù…ØµØ±ÙˆÙØ§Øª ÙƒØ§Ø´: â‚ª ${cashExp}<br>
   Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ùƒ: â‚ª ${bankExp}<br>
   Ø§Ù„ØµØ§ÙÙŠ: â‚ª ${(cashSales+bankSales)-(cashExp+bankExp)}`;
 }
 else if(type=="stock"){
   if(stock.length===0){html="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†";}
   else{
     html="<h4>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø®Ø²Ù†</h4><table><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th></tr>";
     stock.forEach(i=>{
       html+=`<tr><td>${i.name}</td><td>${i.qty}</td><td>â‚ª ${i.price}</td></tr>`;
     });
     html+="</table>";
   }
 }
 else if(type=="details"){
   html="<h4>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø±ÙƒØ§Øª</h4><h5>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h5><ul>";
   sales.forEach((s,i)=>{
     html+=`<li>${s.date} | ${s.name} | â‚ª${s.qty*s.price} | ${s.pay} | ${s.note||""} <button onclick="delSale(${i})">âŒ</button></li>`;
   });
   html+="</ul><h5>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h5><ul>";
   expenses.forEach((e,i)=>{
     html+=`<li>${e.date} | ${e.name} | â‚ª${e.amount} | ${e.pay} | ${e.note||""} <button onclick="delExpense(${i})">âŒ</button></li>`;
   });
   html+="</ul>";
 }
 document.getElementById("repResult").innerHTML=html;
}

/* Ø­Ø°Ù Ø­Ø±ÙƒØ© */
function delSale(i){
 const s=sales[i];
 const total=s.qty*s.price;
 if(s.pay=="cash") cash-=total; else bank-=total;
 stock.find(x=>x.name==s.name).qty+=s.qty;
 sales.splice(i,1);
 save();
}

function delExpense(i){
 const e=expenses[i];
 if(e.pay=="cash") cash+=e.amount; else bank+=e.amount;
 expenses.splice(i,1);
 save();
}

/* PDF */
function printPDF(){
 let w=window.open("");
 w.document.write("<h3>ØªÙ‚Ø±ÙŠØ± Ø±ÙˆØ§Ù†Ø§ Ø´ÙˆØ²</h3>");
 w.document.write(repResult.innerHTML);
 w.print();
}

/* Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© */
function exportBackup(){
 const data={stock,sales,expenses,cash,bank};
 const blob=new Blob([JSON.stringify(data)],{type:"application/json"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="rawana_backup.json";
 a.click();
}

function importBackup(file){
 const r=new FileReader();
 r.onload=()=>{
   const d=JSON.parse(r.result);
   stock=d.stock||[];
   sales=d.sales||[];
   expenses=d.expenses||[];
   cash=d.cash||0;
   bank=d.bank||0;
   save();
   alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø¨Ù†Ø¬Ø§Ø­");
 };
 r.readAsText(file);
}

load();

/* Service Worker Ù„Ø£ÙˆÙÙ„Ø§ÙŠÙ† */
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("sw.js");
}
</script>

</body>
  </html>
